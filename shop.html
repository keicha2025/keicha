---
layout: default
title: KEICHA ç¶²è·¯å•†åº— | æŠ¹èŒ¶ã€èŒ¶å…·ä»£è³¼
description: KEICHA ç¶²è·¯å•†åº—ï¼Œæä¾›å°ˆæ¥­çš„æŠ¹èŒ¶èˆ‡èŒ¶å…·ä»£è³¼æœå‹™ï¼Œå•†å“ç‹€æ…‹å³æ™‚æ›´æ–°ã€‚
keywords: KEICHA, ç¶²è·¯å•†åº—, æŠ¹èŒ¶ä»£è³¼, æŠ¹èŒ¶, èŒ¶å…·, ä¸¸ä¹…å°å±±åœ’, å±±æ”¿å°å±±åœ’, æ˜Ÿé‡è£½èŒ¶åœ’

# ç§»é™¤éœæ…‹ structured_data
structured_data: ""

styles: |
    <style>
        /* è¼‰å…¥ä¸­å‹•ç•« */
        .loader { border-top-color: #6ea44c; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .brand-green-10 { background-color: rgba(110, 164, 76, 0.1); }
        
        /* å´é‚Šæ¬„èˆ‡é¢æ¿é€šç”¨æ¨£å¼ */
        .side-panel {
            position: fixed; top: 0; right: 0; height: 100%; width: 100%; max-width: 400px;
            background-color: white; z-index: 150; transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; flex-direction: column;
            box-shadow: -4px 0 15px rgba(0,0,0,0.1);
        }
        .side-panel.open { transform: translateX(0); }
        .overlay {
            position: fixed; inset: 0; bg-color: rgba(0,0,0,0.5); z-index: 140;
            opacity: 0; visibility: hidden; transition: opacity 0.3s; backdrop-filter: blur(4px);
        }
        .overlay.open { opacity: 1; visibility: visible; }

        /* æµ®å‹•æŒ‰éˆ• */
        .cart-floating-btn {
            position: fixed; bottom: 2rem; right: 2rem; width: 3.5rem; height: 3.5rem;
            background-color: #6ea44c; color: white; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 50;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25); transition: transform 0.2s;
        }
        .cart-floating-btn:hover { transform: scale(1.1); }
    </style>
---

<main>
    <section class="bg-white pt-16 pb-12 shadow-sm">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-4xl font-bold text-brandGreen">ç¶²è·¯å•†åº—</h1>
            <p class="mt-4 text-lg text-gray-600">æ‰€æœ‰å•†å“çš†ç”±å¾Œå°å³æ™‚æ›´æ–°</p>
        </div>
    </section>

    <section id="announcement-section" class="hidden py-4 bg-yellow-100 border-y border-yellow-300">
        <div class="container mx-auto px-4 text-center font-medium text-yellow-800" id="announcement-content"></div>
    </section>

    <section class="py-16 md:py-24">
        <div class="container mx-auto px-4 max-w-7xl">
            <div id="products-loader" class="flex justify-center items-center h-48">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-300 h-16 w-16"></div>
            </div>
            <div id="category-container" class="space-y-16"></div>
        </div>
    </section>

    <section id="notes-section" class="hidden py-16 md:py-24 bg-gray-100 border-t border-gray-200">
        <div class="container mx-auto px-4 max-w-3xl">
            <h2 class="text-3xl font-bold text-center mb-8">æœå‹™èˆ‡è³¼è²·é ˆçŸ¥</h2>
            <div id="general-notes-content" class="prose max-w-none text-gray-700 space-y-4"></div>
        </div>
    </section>
</main>

<div id="global-overlay" class="overlay fixed inset-0 bg-black/50 z-[140]" onclick="closeAllPanels()"></div>

<div id="cart-sidebar" class="side-panel">
    <div class="p-4 border-b flex justify-between items-center bg-gray-50">
        <h2 class="text-xl font-bold text-gray-800 flex items-center gap-2">ğŸ›’ è³¼ç‰©è»Š</h2>
        <button onclick="closeAllPanels()" class="text-2xl">&times;</button>
    </div>
    <div id="cart-items-container" class="flex-grow overflow-y-auto p-6 space-y-4"></div>
    <div class="p-6 border-t bg-gray-50">
        <div class="flex justify-between items-center mb-4">
            <span class="text-gray-600 font-medium">ç¸½è¨ˆé‡‘é¡</span>
            <span id="cart-total-price" class="text-2xl font-bold text-brandGreen">NT$ 0</span>
        </div>
        <button onclick="checkout()" class="w-full bg-brandGreen text-white font-bold py-4 rounded-xl shadow-lg">å‰å¾€çµå¸³</button>
    </div>
</div>

<div id="user-panel" class="side-panel">
    <div class="p-6 bg-brandGreen text-white flex justify-between items-center shadow-md">
        <h3 id="panel-title" class="text-xl font-bold text-white flex items-center gap-2">
            <span class="material-symbols-rounded">account_circle</span>æœƒå“¡è³‡æ–™
        </h3>
        <div class="flex items-center gap-2">
            <button id="edit-toggle-btn" onclick="toggleEditMode()" class="material-symbols-rounded text-white p-2 hover:bg-white/10 rounded-full">edit</button>
            <button onclick="closeAllPanels()" class="material-symbols-rounded text-white p-2 hover:bg-white/10 rounded-full">close</button>
        </div>
    </div>
    <div id="panel-body" class="p-8 flex-1 overflow-y-auto"></div>
    <div id="save-area" class="p-6 border-t hidden">
        <button onclick="saveProfile()" class="w-full bg-brandGreen text-white py-4 rounded-xl font-bold flex justify-center items-center gap-2">
            <span>ç¢ºèªæ›´æ–°</span><span id="save-icon" class="material-symbols-rounded text-white">sync</span>
        </button>
    </div>
</div>

<div id="cart-floating-btn" class="cart-floating-btn" onclick="openCart()">
    <span class="material-symbols-rounded">shopping_cart</span>
    <span id="cart-count-badge" class="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-5 h-5 flex items-center justify-center rounded-full border-2 border-white hidden">0</span>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbyUq36i64Z-JGcERE_rZOdphVtVDX8L-lguc7eiUIdoAERqI1ZK8GWAL-HgbC75cuMHFg/exec";
    const siteBaseUrl = "{{ site.baseurl | default: '' }}";
    let cart = [];
    let isEditMode = false;

    async function initShop() {
        try {
            const res = await fetch(GAS_URL);
            const data = await res.json();
            
            if (data.settings) {
                const { announcement, general_notes } = data.settings;
                if (announcement?.trim()) {
                    document.getElementById('announcement-content').innerText = announcement;
                    document.getElementById('announcement-section').classList.remove('hidden');
                }
                if (general_notes?.trim()) {
                    document.getElementById('general-notes-content').innerHTML = general_notes.replace(/\n/g, '<br>');
                    document.getElementById('notes-section').classList.remove('hidden');
                }
            }
            renderProducts(data.products);
            document.getElementById('products-loader').classList.add('hidden');
            injectHeaderStatus();
        } catch (e) { console.error("Load Failed", e); }
    }

    function renderProducts(products) {
        const container = document.getElementById('category-container');
        const grouped = products.reduce((acc, p) => {
            const cat = p.category || "ç²¾é¸å•†å“";
            if (!acc[cat]) acc[cat] = [];
            acc[cat].push(p);
            return acc;
        }, {});

        container.innerHTML = Object.keys(grouped).map(cat => `
            <section class="space-y-8">
                <h3 class="text-2xl font-bold border-l-4 border-brandGreen pl-4">${cat}</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-x-6 gap-y-10">
                    ${grouped[cat].map(p => {
                        const isSoldOut = p.stock !== "" && parseInt(p.stock) === 0;
                        let img = p.image_url || "";
                        if (img && !img.startsWith('http')) img = siteBaseUrl + (img.startsWith('/') ? img : '/' + img);
                        
                        return `
                        <div class="bg-white rounded-xl border border-gray-100 overflow-hidden shadow-sm flex flex-col group transition hover:shadow-lg">
                            ${img ? `<div class="relative aspect-square overflow-hidden bg-gray-50">
                                <img src="${img}" class="w-full h-full object-cover group-hover:scale-105 transition duration-500 ${isSoldOut ? 'opacity-40 grayscale' : ''}">
                                ${isSoldOut ? `<span class="absolute inset-0 m-auto w-fit h-fit bg-gray-800 text-white text-xs px-3 py-1.5 rounded-full font-bold">å·²å”®ç½„</span>` : ''}
                            </div>` : ''}
                            <div class="p-5 flex-1 flex flex-col">
                                <h4 class="font-bold text-gray-800 mb-1 line-clamp-2">${p.product_name}</h4>
                                ${p.special_notes ? `<p class="text-gray-400 text-[11px] mb-3 line-clamp-2 italic">${p.special_notes}</p>` : ''}
                                <div class="mt-auto pt-4">
                                    <p class="text-brandGreen font-bold text-lg font-mono mb-4">NT$ ${p.price}</p>
                                    <button onclick="addToCart('${p.product_id}', '${p.product_name}', ${p.price}, '${img}')" 
                                            class="w-full py-3 rounded-xl font-bold bg-brandGreen text-white transition-all active:scale-95 ${isSoldOut ? 'bg-gray-100 text-gray-400 cursor-not-allowed' : 'hover:bg-opacity-90'}" 
                                            ${isSoldOut ? 'disabled' : ''}>
                                        ${isSoldOut ? 'æš«ç„¡å­˜è²¨' : 'åŠ å…¥è³¼ç‰©è»Š'}
                                    </button>
                                </div>
                            </div>
                        </div>`;
                    }).join('')}
                </div>
            </section>
        `).join('');
    }

    // --- æœƒå“¡é¢æ¿æ¸²æŸ“ ---
    function openUserPanel() {
        isEditMode = false;
        renderUserView();
        document.getElementById('global-overlay').classList.add('open');
        document.getElementById('user-panel').classList.add('open');
    }

    function renderUserView() {
        const user = JSON.parse(localStorage.getItem('keicha_v2_user'));
        const body = document.getElementById('panel-body');
        document.getElementById('save-area').classList.add('hidden');
        document.getElementById('edit-toggle-btn').innerText = "edit";

        body.innerHTML = `
            <div class="space-y-8">
                <div>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold mb-2">å§“å</p>
                    <p class="text-lg font-bold text-gray-800">${user.name || 'æœªå¡«å¯«'}</p>
                </div>
                <div>
                    <p class="text-[10px] text-gray-400 uppercase tracking-widest font-bold mb-2">é›»å­éƒµä»¶</p>
                    <p class="text-lg font-bold text-gray-800">${user.email || 'æœªå¡«å¯«'}</p>
                </div>
                <div class="pt-4 border-t space-y-4">
                    <h4 class="text-xs font-bold text-brandGreen uppercase tracking-widest">æ”¶ä»¶è¨­å®š</h4>
                    ${renderStoreItem("7-11", user.store_711, user.store_711_note)}
                    ${renderStoreItem("å…¨å®¶", user.store_fami, user.store_fami_note, "store_fami")}
                    ${renderAddressItem("å®…é…åœ°å€", user.shipping_address)}
                </div>
            </div>
        `;
    }

    function renderStoreItem(label, code, note, key) {
        if (!code) return `<button onclick="toggleEditMode()" class="w-full py-3 border-2 border-dashed border-gray-200 rounded-xl text-gray-400 text-xs font-bold hover:text-brandGreen hover:border-brandGreen">+ æ–°å¢${label}é–€å¸‚</button>`;
        return `<div class="p-4 bg-gray-50 rounded-xl"><p class="text-xs font-bold mb-1">${label}é–€å¸‚ï¼š${code}</p><p class="text-[10px] text-gray-400">${note || ''}</p></div>`;
    }

    function renderAddressItem(label, addr) {
        if (!addr) return `<button onclick="toggleEditMode()" class="w-full py-3 border-2 border-dashed border-gray-200 rounded-xl text-gray-400 text-xs font-bold hover:text-brandGreen hover:border-brandGreen">+ æ–°å¢å®…é…åœ°å€</button>`;
        return `<div class="p-4 bg-gray-50 rounded-xl"><p class="text-xs font-bold mb-1">${label}</p><p class="text-[10px] text-gray-400">${addr}</p></div>`;
    }

    function toggleEditMode() {
        isEditMode = !isEditMode;
        isEditMode ? renderUserEdit() : renderUserView();
    }

    function renderUserEdit() {
        const user = JSON.parse(localStorage.getItem('keicha_v2_user'));
        const body = document.getElementById('panel-body');
        document.getElementById('save-area').classList.remove('hidden');
        document.getElementById('edit-toggle-btn').innerText = "visibility";

        body.innerHTML = `
            <div class="space-y-6">
                <div class="flex items-end gap-2">
                    <div class="flex-1">
                        <label class="block text-[10px] font-bold text-gray-400 mb-1">å§“å</label>
                        <input type="text" id="in-name" value="${user.name || ''}" class="w-full p-3 bg-gray-50 rounded-lg outline-none focus:ring-1 ring-brandGreen">
                    </div>
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 mb-1">é›»å­éƒµä»¶</label>
                    <input type="email" id="in-email" value="${user.email || ''}" class="w-full p-3 bg-gray-50 rounded-lg outline-none focus:ring-1 ring-brandGreen">
                </div>
                <div class="p-5 brand-green-10 rounded-2xl space-y-4">
                    <p class="text-xs font-bold text-brandGreen">7-11 é–€å¸‚</p>
                    <input type="text" id="in-711" value="${user.store_711 || ''}" placeholder="åº—è™Ÿ" class="w-full p-3 rounded-lg border-none outline-none">
                    <input type="text" id="in-711-note" value="${user.store_711_note || ''}" placeholder="åº—åå‚™è¨»" class="w-full p-3 rounded-lg border-none outline-none text-xs">
                </div>
                <div class="p-5 bg-blue-50 rounded-2xl space-y-4">
                    <p class="text-xs font-bold text-blue-600">å…¨å®¶ é–€å¸‚</p>
                    <input type="text" id="in-fami" value="${user.store_fami || ''}" placeholder="åº—è™Ÿ" class="w-full p-3 rounded-lg border-none outline-none">
                    <input type="text" id="in-fami-note" value="${user.store_fami_note || ''}" placeholder="åº—åå‚™è¨»" class="w-full p-3 rounded-lg border-none outline-none text-xs">
                </div>
                <div>
                    <label class="block text-[10px] font-bold text-gray-400 mb-1">å®…é…åœ°å€</label>
                    <textarea id="in-addr" class="w-full p-3 bg-gray-50 rounded-lg outline-none focus:ring-1 ring-brandGreen text-sm" rows="2">${user.shipping_address || ''}</textarea>
                </div>
            </div>
        `;
    }

    async function saveProfile() {
        const stored = JSON.parse(localStorage.getItem('keicha_v2_user'));
        const icon = document.getElementById('save-icon');
        const payload = {
            action: 'save',
            phone: stored.phone,
            name: document.getElementById('in-name').value,
            email: document.getElementById('in-email').value,
            store_711: document.getElementById('in-711').value,
            store_711_note: document.getElementById('in-711-note').value,
            store_fami: document.getElementById('in-fami').value,
            store_fami_note: document.getElementById('in-fami-note').value,
            shipping_address: document.getElementById('in-addr').value
        };

        icon.classList.add('animate-spin');
        const res = await fetch(GAS_URL, { method: 'POST', body: JSON.stringify(payload) });
        const result = await res.json();
        if (result.success) {
            localStorage.setItem('keicha_v2_user', JSON.stringify({...stored, ...payload}));
            renderUserView();
            location.reload();
        }
    }

    function openCart() {
        document.getElementById('global-overlay').classList.add('open');
        document.getElementById('cart-sidebar').classList.add('open');
    }

    function closeAllPanels() {
        document.querySelectorAll('.side-panel, .overlay').forEach(el => el.classList.remove('open'));
    }

    function addToCart(id, name, price, img) {
        cart.push({ id, name, price, img });
        updateCartUI();
        openCart();
    }

    function updateCartUI() {
        const container = document.getElementById('cart-items-container');
        const count = cart.length;
        document.getElementById('cart-count-badge').innerText = count;
        document.getElementById('cart-count-badge').classList.toggle('hidden', count === 0);
        
        if (count === 0) {
            container.innerHTML = `<p class="text-center text-gray-400 mt-10 italic">æ‚¨çš„è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>`;
            document.getElementById('cart-total-price').innerText = "NT$ 0";
            return;
        }

        let total = 0;
        container.innerHTML = cart.map((item, idx) => {
            total += item.price;
            return `
            <div class="flex gap-4 items-center">
                <img src="${item.img || siteBaseUrl+'/images/placeholder.png'}" class="w-12 h-12 object-cover rounded-md bg-gray-100">
                <div class="flex-1">
                    <p class="text-xs font-bold text-gray-800 line-clamp-1">${item.name}</p>
                    <p class="text-xs text-brandGreen font-mono">NT$ ${item.price}</p>
                </div>
                <button onclick="removeItem(${idx})" class="text-gray-300 hover:text-red-500">&times;</button>
            </div>`;
        }).join('');
        document.getElementById('cart-total-price').innerText = `NT$ ${total.toLocaleString()}`;
    }

    function removeItem(idx) {
        cart.splice(idx, 1);
        updateCartUI();
    }

    function injectHeaderStatus() {
        const user = JSON.parse(localStorage.getItem('keicha_v2_user'));
        const nav = document.querySelector('nav.hidden.md\\:flex'); 
        if (!nav) return;
        const div = document.createElement('div');
        div.className = "mr-2 border-r pr-2 border-gray-100";
        div.innerHTML = user ? 
            `<button onclick="openUserPanel()" class="flex items-center gap-1 text-brandGreen font-bold border px-3 py-2 rounded-md bg-white text-xs hover:bg-gray-50 transition shadow-sm"><span class="material-symbols-rounded text-lg">account_circle</span>${user.name || user.phone}</button>` : 
            `<a href="member.html" class="p-2 text-gray-400 hover:text-brandGreen transition"><span class="material-symbols-rounded">login</span></a>`;
        nav.insertBefore(div, nav.firstChild);
    }

    window.onload = initShop;
</script>
