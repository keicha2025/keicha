<header class="bg-white shadow-md sticky top-0 z-50 h-20">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-6xl h-full flex justify-between items-center">
        
        <!-- Logo -->
        <a href="{{ site.baseurl }}/index.html" class="flex items-center">
            <img src="{{ site.baseurl }}/images/KEICHA_LOGO.svg" alt="KEICHA Logo" class="h-14 rounded-lg">
        </a>

        <!-- æ¡Œé¢ç‰ˆå°è¦½åˆ— (æœªè®Šå‹•) -->
        <nav class="hidden md:flex items-center space-x-2 lg:space-x-4">
            
            <div class="relative">
                <button id="desktop-dropdown-button" class="px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-50 flex items-center">
                    <span>æœå‹™ç¸½è¦½</span>
                    <svg class="w-4 h-4 ml-1" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
                <div id="desktop-dropdown-menu" data-state="closed" class="dropdown-menu absolute left-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50">
                    <a href="{{ site.baseurl }}/maccha.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        æŠ¹èŒ¶ä»£è³¼ç‹€æ³
                    </a>
                    <a href="{{ site.baseurl }}/denwa.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        é›»è©±ä»£æ’­æœå‹™
                    </a>
                    <a href="{{ site.baseurl }}/jyoukyou.html" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">
                        è¨‚å–®è¿½è¹¤
                    </a>
                </div>
            </div>

            <a href="https://myship.7-11.com.tw/cart/easy/GM2510186847800" target="_blank" rel="noopener noreferrer" class="px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-50">
                è²¨åˆ°ä»˜æ¬¾ä¸‹å–®
            </a>

            <a href="https://pcpay.tw/NF4vv" target="_blank" rel="noopener noreferrer" class="px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-50">
                æ¬¾é …æ”¯ä»˜
            </a>

            <button type="button" id="desktop-share-button" class="p-2 text-brandGreen hover:text-opacity-80 rounded-full focus:outline-none focus:ring-2 focus:ring-brandGreen hidden" title="åˆ†äº«ç¶²ç«™">
                <span class="sr-only">åˆ†äº«ç¶²ç«™</span>
                <span class="material-symbols-rounded text-2xl">ios_share</span>
            </button>

            <a href="https://lin.ee/QJU5mUO" target="_blank" rel="noopener noreferrer" class="ml-2 inline-block bg-brandGreen text-white px-5 py-2 rounded-full text-base font-medium hover:bg-opacity-90 transition duration-300 shadow">
                LINEå®˜æ–¹å®¢æœ
            </a>
        </nav>

        <!-- è¡Œå‹•ç‰ˆæŒ‰éˆ• -->
        <div class="md:hidden flex items-center space-x-2">
            
            <button type="button" id="mobile-share-button-fixed" class="p-2 text-brandGreen rounded-full hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-brandGreen hidden" title="åˆ†äº«ç¶²ç«™">
                <span class="sr-only">åˆ†äº«ç¶²ç«™</span>
                <span class="material-symbols-rounded text-2xl">ios_share</span>
            </button>

            <button id="mobile-menu-button" class="p-2 text-brandGreen rounded-md hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-brandGreen">
                <span class="sr-only">é–‹å•Ÿé¸å–®</span>
                <span class="material-symbols-rounded text-3xl">menu</span>
            </button>
        </div>
    </div>

    <!-- â˜…â˜…â˜… è¡Œå‹•ç‰ˆé¸å–® (Mobile Menu) - æ›´æœ‰å±¤æ¬¡æ„Ÿ â˜…â˜…â˜… -->
    <div id="mobile-menu" class="mobile-menu md:hidden absolute top-20 left-0 w-full bg-white shadow-lg z-40" data-state="closed">
        <div class="px-2 pt-2 pb-3 space-y-1">
            
            <!-- æœå‹™ç¸½è¦½ (å¯æŠ˜ç–Šçš„çˆ¶é¸å–®) -->
            <div class="border-b border-gray-100 pb-1">
                <button id="mobile-dropdown-button" class="w-full px-3 py-3 rounded-md text-base font-bold text-brandGreen flex items-center justify-between hover:bg-gray-50">
                    <span>æœå‹™ç¸½è¦½</span>
                    <!-- ç®­é ­ -->
                    <svg id="mobile-dropdown-icon" class="w-5 h-5 transition-transform duration-300" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"></path></svg>
                </button>
                
                <!-- å­é¸å–®å…§å®¹ (é è¨­éš±è—) -->
                <div id="mobile-dropdown-menu" class="mobile-submenu space-y-1 max-h-0 overflow-hidden transition-all duration-300">
                    <a href="{{ site.baseurl }}/maccha.html" class="block pl-8 pr-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-100">
                        ğŸµ æŠ¹èŒ¶ä»£è³¼ç‹€æ³
                    </a>
                    <a href="{{ site.baseurl }}/denwa.html" class="block pl-8 pr-3 py-2 rounded-md text-sm font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-100">
                        ğŸ“ é›»è©±ä»£æ’­æœå‹™
                    </a>
                </div>
            </div>
            
            <!-- ä¸»è¦é€£çµ (è¼”åŠ©åŠŸèƒ½) -->
            <a href="{{ site.baseurl }}/jyoukyou.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-50">
                ğŸ“ è¨‚å–®è¿½è¹¤
            </a>
            <a href="https://myship.7-11.com.tw/cart/easy/GM2510186847800" target="_blank" rel="noopener noreferrer" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-50">
                ğŸ“¦ è²¨åˆ°ä»˜æ¬¾ä¸‹å–®
            </a>
            <a href="https://pcpay.tw/NF4vv" target="_blank" rel="noopener noreferrer" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-brandGreen hover:bg-gray-50">
                ğŸ’³ æ¬¾é …æ”¯ä»˜
            </a>
            
            <hr class="my-2 border-gray-100">
            
            <!-- è¡Œå‹•ç‰ˆå®¢æœ CTA -->
            <a href="https://lin.ee/QJU5mUO" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-brandGreen text-white px-4 py-2 rounded-md text-base font-medium hover:bg-opacity-90 transition duration-300">
                LINEå®˜æ–¹å®¢æœ
            </a>
        </div>
    </div>
</header>

<!-- â˜…â˜…â˜… å¿…éœ€çš„ JavaScript é‚è¼¯ (å¿…é ˆæ”¾åœ¨ Footer è…³æœ¬å€) â˜…â˜…â˜… -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        const mobileDropdownButton = document.getElementById('mobile-dropdown-button');
        const mobileDropdownMenu = document.getElementById('mobile-dropdown-menu');
        const mobileDropdownIcon = document.getElementById('mobile-dropdown-icon');
        
        // --- 1. æ¼¢å ¡é¸å–®é–‹é—œ ---
        mobileMenuButton.addEventListener('click', () => {
            const isMenuOpen = mobileMenu.getAttribute('data-state') === 'open';
            if (isMenuOpen) {
                mobileMenu.setAttribute('data-state', 'closed');
                mobileMenu.style.maxHeight = '0px';
                mobileMenuButton.querySelector('.material-symbols-rounded').textContent = 'menu';
            } else {
                mobileMenu.setAttribute('data-state', 'open');
                // ç‚ºäº†è®“ CSS æ­£å¸¸éæ¸¡ï¼Œæˆ‘å€‘è¨ˆç®—é«˜åº¦
                mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
                mobileMenuButton.querySelector('.material-symbols-rounded').textContent = 'close';
            }
        });

        // --- 2. è¡Œå‹•ç‰ˆæŠ˜ç–Šé¸å–®é‚è¼¯ ---
        mobileDropdownButton.addEventListener('click', () => {
            const isDropdownOpen = mobileDropdownMenu.classList.contains('open');
            
            if (isDropdownOpen) {
                // é—œé–‰å­é¸å–®
                mobileDropdownMenu.classList.remove('open');
                mobileDropdownMenu.style.maxHeight = '0px';
                mobileDropdownIcon.style.transform = 'rotate(0deg)';
            } else {
                // æ‰“é–‹å­é¸å–®
                mobileDropdownMenu.classList.add('open');
                // è¨­ç½®é«˜åº¦ç‚ºå…¶å…§å®¹çš„scrollHeightï¼Œå¯¦ç¾è‡ªå‹•é«˜åº¦éæ¸¡
                mobileDropdownMenu.style.maxHeight = mobileDropdownMenu.scrollHeight + 'px';
                mobileDropdownIcon.style.transform = 'rotate(180deg)';
            }

            // èª¿æ•´ä¸»é¸å–®é«˜åº¦ä»¥å®¹ç´å­é¸å–®
            setTimeout(() => {
                if (mobileMenu.getAttribute('data-state') === 'open') {
                    mobileMenu.style.maxHeight = mobileMenu.scrollHeight + 'px';
                }
            }, 300); // å»¶é²ï¼Œç¢ºä¿å­é¸å–®é«˜åº¦å·²è¨ˆç®—å®Œç•¢
        });
        
        // --- 3. æ¡Œé¢ç‰ˆä¸‹æ‹‰é¸å–® (ç‚ºæ±‚å®Œæ•´æ€§ï¼Œä¿ç•™æ­¤é‚è¼¯) ---
        const desktopDropdownButton = document.getElementById('desktop-dropdown-button');
        const desktopDropdownMenu = document.getElementById('desktop-dropdown-menu');
        if (desktopDropdownButton && desktopDropdownMenu) {
            desktopDropdownButton.addEventListener('click', () => {
                const isDropdownOpen = desktopDropdownMenu.getAttribute('data-state') === 'open';
                if (isDropdownOpen) {
                    desktopDropdownMenu.setAttribute('data-state', 'closed');
                    desktopDropdownMenu.style.display = 'none';
                } else {
                    desktopDropdownMenu.setAttribute('data-state', 'open');
                    desktopDropdownMenu.style.display = 'block';
                }
            });
            // é»æ“Šå¤–é¢é—œé–‰
            document.addEventListener('click', function(event) {
                if (!desktopDropdownButton.contains(event.target) && !desktopDropdownMenu.contains(event.target)) {
                    desktopDropdownMenu.setAttribute('data-state', 'closed');
                    desktopDropdownMenu.style.display = 'none';
                }
            });
        }
    });

    // é¡å¤–çš„ CSS è®“å­é¸å–®çš„ max-height éæ¸¡ç”Ÿæ•ˆ
    const style = document.createElement('style');
    style.innerHTML = `
        .mobile-submenu {
            padding-top: 0;
            padding-bottom: 0;
        }
        .mobile-submenu.open {
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
        }
    `;
    document.head.appendChild(style);
</script>
