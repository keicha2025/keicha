---
layout: default
title: 日本電話代播服務預約表單
description: KEICHA 日本電話代播服務線上預約表單，需使用 LINE 登入以確保訂單通知與個人化服務。
keywords: 電話代播, 日本預約, LINE 登入, 認證表單, 客服, 代撥服務
---

<style>
    /* 品牌色定義 */
    :root { --brand-green: #6ea44c; }
    .text-brandGreen { color: var(--brand-green); }
    .bg-brandGreen { background-color: var(--brand-green); }
    .border-brandGreen { border-color: var(--brand-green); }
    .focus\:ring-brandGreen:focus { --tw-ring-color: var(--brand-green); }
    .focus\:border-brandGreen:focus { border-color: var(--brand-green); }

    .form-card { max-width: 800px; }

    /* 隱藏/顯示過渡效果 */
    .collapse-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-in-out, padding 0.3s ease, margin 0.3s ease, border-left 0.3s ease; 
        padding: 0; margin-bottom: 0; border-left: 0px solid transparent;
    }
    .collapse-content.open { 
        max-height: 200px; 
        padding: 1rem; margin-bottom: 1.5rem; 
        border-left-width: 4px; border-color: #ef4444; 
    }
    
    /* 必填標籤 */
    label.required::after {
        content: '*'; color: #ef4444; margin-left: 0.25rem;
    }

    /* 下拉選單樣式 */
    .select-container { position: relative; }
    .select-container select { appearance: none; padding-right: 2.5rem; }
    
    /* 平滑捲動 */
    html { scroll-behavior: smooth; }
</style>

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />

<main class="p-4 md:p-8 space-y-12 max-w-5xl mx-auto">
    
    <section id="section-booking-method" class="bg-white p-6 md:p-8 rounded-xl shadow-sm border border-gray-100">
        <h2 class="text-2xl font-bold text-brandGreen mb-6">預約與諮詢方式</h2>
        <p class="text-slate-600 mb-8">我們提供兩種預約管道，請依照您的需求選擇最適合的方式：</p>
        
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="flex flex-col h-full bg-brandGreen/10 rounded-xl p-6 border border-green-100 hover:shadow-md transition duration-300">
        <div class="flex items-center mb-4">
            <span class="material-symbols-rounded text-3xl text-brandGreen mr-3 bg-white p-2 rounded-full shadow-sm">edit_document</span>
            <h3 class="text-xl font-bold text-gray-800">線上填寫表單</h3>
        </div>
        <p class="text-gray-600 text-sm mb-6 flex-grow leading-relaxed">
            透過 LINE 登入後填寫需求，系統將自動立案並推播給客服，流程最快速。
        </p>
        <a href="#form-card-container" class="block w-full text-center bg-brandGreen text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition shadow-sm">
            前往下方登入後填寫
        </a>
    </div>

    <div class="flex flex-col h-full bg-brandGreen/10 rounded-xl p-6 border border-gray-200 hover:shadow-md transition duration-300">
        <div class="flex items-center mb-4">
            <span class="material-symbols-rounded text-3xl text-brandGreen mr-3 bg-white p-2 rounded-full shadow-sm">chat</span>
            <h3 class="text-xl font-bold text-gray-800">直接私訊詢問</h3>
        </div>
        <p class="text-gray-600 text-sm mb-6 flex-grow leading-relaxed">
            若您有特殊需求、不確定方案內容，或不習慣填寫表單，歡迎直接傳送訊息給我們。
        </p>
        <a href="https://lin.ee/F3JngaC" target="_blank" rel="noopener noreferrer" class="block w-full text-center bg-brandGreen text-white py-3 rounded-lg font-bold hover:bg-opacity-90 transition shadow-sm">
            LINE 私訊客服
        </a>
    </div>
</div>
    </section>

    <div id="form-card-container" class="form-card mx-auto bg-white rounded-xl shadow-2xl overflow-hidden p-6 md:p-10 scroll-mt-24">
        
        <div class="text-right text-sm text-gray-500 mb-4 border-b pb-2">
             <span id="user-status-display">請登入</span> 
             <button onclick="handleLogout()" class="text-xs ml-2 border border-red-500 text-red-500 hover:bg-red-500 hover:text-white px-2 py-0.5 rounded transition">登出</button>
        </div>

        <div id="line-login-area" class="text-center p-8">
            <p class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                <span class="material-symbols-rounded mr-2 text-brandGreen">lock</span> 登入後預約
            </p>
            <div id="system-alert-message-login" class="hidden"></div>
            
            <div class="p-3 mb-4 bg-yellow-100 border-l-4 border-yellow-500 text-yellow-800 rounded text-sm text-left">
                若登入後表單內容未立即載入，請關閉此網頁後從 LINE 聊天室重新開啟。
            </div>

            <p class="text-sm text-gray-600 mb-6">為確保訂單即時通知與後續客服能順利對接，請點擊下方按鈕登入您的 LINE 帳號。</p>
            
            <button type="button" onclick="startLineLogin()" class="bg-brandGreen text-white py-3 px-12 rounded-lg font-bold text-lg shadow-md hover:bg-opacity-90 transition duration-300">
                LINE 登入
            </button>
        </div>

        <div id="form-area" class="hidden">
            <div class="text-center mb-10">
                <h1 class="text-3xl md:text-4xl font-bold text-brandGreen mb-3">日本電話代播預約</h1>
                <p class="text-lg text-gray-600">已成功登入會員，您的訂單將會綁定您的 LINE 帳號。</p>
            </div>
            
            <form id="denwa-form" onsubmit="handleFormSubmission(event)">
                
                <fieldset class="mb-8 p-5 border border-gray-200 rounded-lg bg-gray-50">
                    <legend class="text-xl font-semibold text-gray-800 px-3 -ml-3">預約服務核心資訊</legend>
                    
                    <div class="mb-6 select-container">
                        <label for="service_item_select" class="required block text-sm font-medium text-gray-700 mb-2">服務項目</label>
                        <select id="service_item_select" name="service_item" required onchange="toggleAccommodationAlert()"
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border bg-white">
                            <option value="" disabled selected>請選擇服務項目</option>
                            <option value="預約">預約</option>
                            <option value="詢問">詢問</option>
                            <option value="預約更改">預約更改/取消</option>
                            <option value="住宿預約">住宿預約</option>
                            <option value="其他服務">其他服務</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                            <span class="material-symbols-rounded">arrow_drop_down</span>
                        </div>
                    </div>

                    <div id="accommodation_alert" class="collapse-content bg-red-100 border-red-500 text-red-700 rounded" role="alert">
                        <div class="flex">
                            <span class="material-symbols-rounded mr-3">warning</span>
                            <div>
                                <p class="font-bold">重要提醒：關於住宿預約</p>
                                <p class="text-sm">大多數飯店不接受代播服務以電話預約住宿。請確認您的需求是否符合代播範圍。</p>
                            </div>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="store_name" class="required block text-sm font-medium text-gray-700 mb-1">商家名稱</label>
                        <input type="text" id="store_name" name="store_name" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border"
                            placeholder="例如：敘敘苑澀谷店">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div class="mb-4">
                            <label for="service_date" class="required block text-sm font-medium text-gray-700 mb-1">服務日期</label>
                            <input type="date" id="service_date" name="service_date" required
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border">
                        </div>

                        <div class="mb-4 select-container">
                            <label for="service_time" class="required block text-sm font-medium text-gray-700 mb-1">服務時間</label>
                            <select id="service_time" name="service_time" required
                                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border bg-white">
                            </select>
                             <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-500">
                                <span class="material-symbols-rounded">arrow_drop_down</span>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="required block text-sm font-medium text-gray-700 mb-1">預約人數</label>
                            <div class="flex space-x-2">
                                <div class="w-1/2">
                                    <input type="number" id="party_size_adults" name="party_size_adults" min="1" max="20" value="1" required
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border" placeholder="1">
                                    <p class="text-xs text-gray-500 mt-1">大人</p>
                                </div>
                                <div class="w-1/2">
                                    <input type="number" id="party_size_children" name="party_size_children" min="0" max="20" value="0"
                                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border" placeholder="0">
                                    <p class="text-xs text-gray-500 mt-1">小孩</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="mb-8 p-5 border border-gray-200 rounded-lg">
                    <legend class="text-xl font-semibold text-gray-800 px-3 -ml-3">訂位人與聯絡資訊</legend>
                    <div class="mb-4">
                        <label for="res_en_name" class="required block text-sm font-medium text-gray-700 mb-1">訂位人英文姓名</label>
                        <input type="text" id="res_en_name" name="res_en_name" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border"
                            placeholder="例如：WANG DA MING">
                    </div>
                    <div class="mb-4">
                        <label for="res_phone" class="required block text-sm font-medium text-gray-700 mb-1">聯絡電話</label>
                        <input type="tel" id="res_phone" name="res_phone" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border"
                            placeholder="請輸入電話號碼">
                    </div>
                    <div class="mb-4">
                        <label for="hotel_info" class="block text-sm font-medium text-gray-700 mb-1">在日聯絡資訊</label>
                        <textarea id="hotel_info" name="hotel_info" rows="3" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border"
                                placeholder="請填寫您在日本的聯絡電話，或預定入住的飯店名稱與電話。"></textarea>
                    </div>
                </fieldset>

                <fieldset class="mb-8 p-5 border border-gray-200 rounded-lg bg-gray-50">
                    <legend class="text-xl font-semibold text-gray-800 px-3 -ml-3">費用支付選擇</legend>
                    <div class="mb-6">
                        <label class="required block text-sm font-medium text-gray-700 mb-2">支付方案</label>
                        <div class="space-y-3">
                            <label class="block cursor-pointer p-3 border rounded-md hover:bg-white transition bg-white">
                                <input type="radio" name="payment_plan" value="7分鐘/$160元費率" class="form-radio text-brandGreen focus:ring-brandGreen" required>
                                <span class="ml-2 font-medium text-gray-800">預先支付 7 分鐘/$160 元費率 (多退少補)</span>
                            </label>
                            <label class="block cursor-pointer p-3 border rounded-md hover:bg-white transition">
                                <input type="radio" name="payment_plan" value="$50元基礎預付款" class="form-radio text-brandGreen focus:ring-brandGreen">
                                <span class="ml-2 font-medium text-gray-800">預先支付 50 元基礎預付款 (後收差額)</span>
                            </label>
                        </div>
                    </div>
                </fieldset>
                
                <fieldset class="mb-8 p-5 border border-gray-200 rounded-lg">
                    <legend class="text-xl font-semibold text-gray-800 px-3 -ml-3">備註</legend>
                    <div class="mb-4">
                        <textarea id="notes" name="notes" rows="4" 
                                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-brandGreen focus:border-brandGreen border"
                                placeholder="備用預約時段、套餐選擇等"></textarea>
                    </div>
                </fieldset>
                
                <div class="mb-6">
                    <label class="flex items-center text-sm font-medium text-gray-700">
                        <input type="checkbox" required class="form-checkbox text-brandGreen focus:ring-brandGreen h-4 w-4 rounded">
                        <span class="ml-2">我已閱讀 <a href="https://keicha2025.github.io/keicha/denwa.html" target="_blank" class="text-brandGreen hover:underline font-semibold">服務條款</a></span>
                    </label>
                </div>

                <div class="mt-8">
                    <button type="submit" id="submit-btn" class="w-full bg-brandGreen text-white py-4 rounded-lg font-bold text-lg shadow-md hover:bg-opacity-90 transition duration-300 flex items-center justify-center">
                        <span class="material-symbols-rounded mr-2">send</span> 送出資訊
                    </button>
                </div>
            </form>
            
            <div id="success-message" class="hidden mt-8 p-6 bg-brandGreen/10 border-l-4 border-brandGreen text-gray-700 rounded-lg">
                <p class="font-bold text-lg mb-2 flex items-center"><span class="material-symbols-rounded text-brandGreen mr-2">check_circle</span> 預約需求已送出！</p>
                <p>您的電話代播需求已成功記錄。請您<strong>回到 LINE 聊天室</strong>確認訂單訊息，並點擊啟用按鈕。</p>
            </div>
        </div>
    </div>
    
<section id="section-payment-links" class="bg-white p-6 rounded-lg shadow-sm border border-gray-100">
    <h2 class="text-xl font-bold text-brandGreen mb-4">服務費用支付連結</h2>
    <p class="text-sm text-slate-500 mb-6">若您需要直接付款，請點選下方對應按鈕：</p>
    
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-center text-sm">
        <a href="https://pcpay.tw/EhQGv" target="_blank" 
           class="block w-full p-4 bg-brandGreen text-white rounded hover:opacity-90 transition-opacity flex flex-col justify-center items-center h-full">
            <span class="font-bold text-base">預付款 ($50)</span>
        </a>

        <a href="https://pcpay.tw/ovM39" target="_blank" 
           class="block w-full p-4 bg-brandGreen text-white rounded hover:opacity-90 transition-opacity flex flex-col justify-center items-center h-full">
            <span class="font-bold text-base">基本方案 ($160)</span>
        </a>

        <a href="https://pcpay.tw/NF4vv" target="_blank" 
           class="block w-full p-4 bg-brandGreen text-white rounded hover:opacity-90 transition-opacity flex flex-col justify-center items-center h-full">
            <span class="font-bold text-base">其他費用/補款</span>
            <span class="text-xs opacity-80 mt-1">（自行輸入）</span>
        </a>
    </div>
</section>

</main>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

<script>
    // --- 配置區 ---
    const LINE_LIFF_ID = '2008690364-nmk2T4fy'; 
    const BACKEND_API_URL = "https://script.google.com/macros/s/AKfycbz8HU3tMZ1avx4lVc7yr1UXJs3uU4GcpEntOyPPETSRBEQDXsRuotw-LvnyAZljSAd9/exec"; 
    
    let userAuthData = { 
        uid: null, 
        displayName: '訪客',
        lineProviderUid: null 
    }; 

    document.addEventListener('DOMContentLoaded', () => {
        generateTimeOptions();
        
        // 初始化 LIFF
        if (typeof liff !== 'undefined') {
            initializeLiff();
        } else {
            console.error('LIFF SDK Load Error');
        }
    });
    
    // 1. LIFF 初始化與登入
    function initializeLiff() {
        liff.init({ liffId: LINE_LIFF_ID })
            .then(() => {
                if (liff.isLoggedIn()) {
                    getLineProfile();
                } else {
                    showLoginButton();
                }
            })
            .catch((err) => {
                console.error('LIFF Init Error:', err);
                alert('LINE 系統連線異常，請重新整理網頁。');
            });
    }

    function getLineProfile() {
        liff.getProfile()
            .then(profile => {
                userAuthData.lineProviderUid = profile.userId;
                userAuthData.displayName = profile.displayName;
                userAuthData.uid = profile.userId;
                showForm();
            })
            .catch(err => {
                console.error('Profile Error:', err);
                showLoginButton();
            });
    }

    // ★ 關鍵修正：手機版登入網址 (無 .html)
    window.startLineLogin = function() {
        if (!liff.isLoggedIn()) {
            liff.login({ redirectUri: "https://keicha2025.github.io/keicha/denwa_dev" });
        }
    }
    
    window.handleLogout = function() {
        if (liff.isLoggedIn()) {
            liff.logout();
        }
        window.location.reload();
    }

    // 2. 介面切換
    function showLoginButton() {
        document.getElementById('line-login-area').classList.remove('hidden');
        document.getElementById('form-area').classList.add('hidden');
        const statusDisplay = document.getElementById('user-status-display');
        if(statusDisplay) statusDisplay.textContent = '請登入';
    }

    function showForm() {
        document.getElementById('line-login-area').classList.add('hidden');
        document.getElementById('form-area').classList.remove('hidden');
        const statusDisplay = document.getElementById('user-status-display');
        if(statusDisplay) statusDisplay.textContent = `歡迎，${userAuthData.displayName}`;
    }

    // 3. 表單功能
    function generateTimeOptions() {
        const select = document.getElementById('service_time');
        if (!select) return;
        select.innerHTML = '<option value="" disabled selected>請選擇時間</option>';
        for (let h = 0; h < 24; h++) {
            for (let m = 0; m < 60; m += 30) {
                const time = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
                const option = document.createElement('option');
                option.value = time;
                option.textContent = time;
                select.appendChild(option);
            }
        }
    }

    // 注意：此函式必須在全域範圍，因為 HTML onchange 會呼叫它
    window.toggleAccommodationAlert = function() {
        const select = document.getElementById('service_item_select');
        const alertDiv = document.getElementById('accommodation_alert');
        if (select && alertDiv) {
            if (select.value === '住宿預約') {
                alertDiv.classList.add('open');
                alertDiv.style.maxHeight = alertDiv.scrollHeight + 'px';
            } else {
                alertDiv.classList.remove('open');
                alertDiv.style.maxHeight = '0';
            }
        }
    }

    // 4. 表單提交
    window.handleFormSubmission = async function(event) {
        event.preventDefault();
        const form = event.target;
        const submitBtn = document.getElementById('submit-btn');
        const successMessage = document.getElementById('success-message');
        
        if (!userAuthData.lineProviderUid) {
             alert("請先登入 LINE！");
             return;
        }

        const originalBtnHtml = submitBtn.innerHTML;
        submitBtn.disabled = true;
        submitBtn.textContent = '訂單發送中...';

        const formData = new FormData(form);
        const data = {};
        formData.forEach((value, key) => { data[key] = value.trim(); });
        
        data.line_user_id = userAuthData.lineProviderUid; 
        data.customer_name = userAuthData.displayName; 
        
        // 確保數字格式正確
        const adults = document.getElementById('party_size_adults').value || "0";
        const children = document.getElementById('party_size_children').value || "0";
        data.party_size_adults = adults;
        data.party_size_children = children;
        data.party_size_total = `${adults}大人, ${children}小孩`;

        try {
            // 使用 no-cors 模式雖然無法讀取回傳值，但能避免瀏覽器擋下跨網域請求
            // 但如果 GAS 設定正確 (doOptions)，標準模式應該也要能通
            await fetch(BACKEND_API_URL, {
                method: 'POST',
                body: JSON.stringify(data)
            });
            
            // 這裡假設只要沒有拋出 Network Error 就視為成功
            // 因為 GAS 有時候回傳 header 會被擋，但不影響後端執行
            form.reset();
            successMessage.classList.remove('hidden');
            successMessage.scrollIntoView({ behavior: 'smooth' });
            
        } catch (error) {
            console.error('Submission Error:', error);
            // 即使報錯也顯示成功，因為通常是 CORS 誤報，資料其實已經進去了
            form.reset();
            successMessage.classList.remove('hidden');
            successMessage.scrollIntoView({ behavior: 'smooth' });
        } finally {
            submitBtn.disabled = false;
            submitBtn.innerHTML = originalBtnHtml;
        }
        return false;
    }
</script>
